version: '3.8'

services:
  eaif-postgres:
    image: postgres:16-alpine
    container_name: eaif-postgres
    restart: unless-stopped
    ports:
      - '5432:5432'
    environment:
      POSTGRES_USER: eaif
      POSTGRES_PASSWORD: eaif_dev_password
      POSTGRES_DB: eaif
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U eaif -d eaif']
      interval: 10s
      timeout: 5s
      retries: 5

  eaif-timescaledb:
    image: timescale/timescaledb:latest-pg16
    container_name: eaif-timescaledb
    restart: unless-stopped
    ports:
      - '5433:5432'
    environment:
      POSTGRES_USER: eaif
      POSTGRES_PASSWORD: eaif_dev_password
      POSTGRES_DB: eaif_events
    volumes:
      - timescale_data:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U eaif -d eaif_events']
      interval: 10s
      timeout: 5s
      retries: 5

  eaif-neo4j:
    image: neo4j:5-community
    container_name: eaif-neo4j
    restart: unless-stopped
    ports:
      - '7474:7474'  # HTTP
      - '7687:7687'  # Bolt
    environment:
      NEO4J_AUTH: neo4j/neo4j_dev_password
      NEO4J_PLUGINS: '["apoc"]'
      NEO4J_dbms_security_procedures_unrestricted: apoc.*
      NEO4J_dbms_security_procedures_allowlist: apoc.*
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
    healthcheck:
      test: ['CMD-SHELL', 'wget --no-verbose --tries=1 --spider http://localhost:7474 || exit 1']
      interval: 10s
      timeout: 5s
      retries: 5

  eaif-redis:
    image: redis:7-alpine
    container_name: eaif-redis
    restart: unless-stopped
    ports:
      - '6379:6379'
    volumes:
      - redis_data:/data
    healthcheck:
      test: ['CMD', 'redis-cli', 'ping']
      interval: 10s
      timeout: 5s
      retries: 5

  eaif-qdrant:
    image: qdrant/qdrant:v1.7.4
    container_name: eaif-qdrant
    restart: unless-stopped
    ports:
      - '6333:6333'  # HTTP API
      - '6334:6334'  # gRPC
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ['CMD-SHELL', 'wget --no-verbose --tries=1 --spider http://localhost:6333/health || exit 1']
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
  timescale_data:
  neo4j_data:
  neo4j_logs:
  redis_data:
  qdrant_data:
